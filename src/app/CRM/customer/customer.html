<div class="row" ng-if="dataReady">
  <div class="col-md-12">
    <!-- BEGIN Portlet PORTLET-->
    <div class="portlet box">
      <div class="portlet-title ThemeColor">
        <div class="caption">
          {{ "crm.customer.customer.customer-details" | translate }}
        </div>
      </div>
      <div class="portlet-body">
      <!--Top row -->
        <div class="row ">
          <div class="col-md-4">
            <div class="font-sans-serif size-17 weight-bold inline margin-bottom-15">
              {{customerDetails.FirstName}} {{customerDetails.LastName}}
              <a href="javascript:;" ng-click="editCustomer(customerDetails.CustomerGuid)">
                <i class="fa fa-pencil"></i>
              </a>
            </div>
            <div class="row">
              <div class="col-md-5 col-sm-6 col-xs-6 text-align-left">{{ "crm.customer.customer.customer-id" | translate }}:</div>
              <div class="col-md-7 col-sm-6 col-xs-6 text-align-right">{{customerDetails.CustomerID}}</div>
            </div>
            <div class="row">
              <div class="col-md-5 col-sm-6 col-xs-6 text-align-left">{{ "crm.customer.customer.type" | translate }}:</div>
              <div class="col-md-7 col-sm-6 col-xs-6 text-align-right">{{customerDetails.Type}}</div>
            </div>
            <div class="row">
              <div class="col-md-5 col-sm-6 col-xs-6 text-align-left">{{ "crm.customer.customer.date-created" | translate }}:</div>
              <div class="col-md-7 col-sm-6 col-xs-6 text-align-right">{{customerDetails.DateCreated | date : 'fullDate'}}</div>
            </div>
            <div class="row">
              <div class="col-md-5 col-sm-6 col-xs-6 text-align-left">{{ "crm.customer.customer.date-modified" | translate }}:</div>
              <div class="col-md-7 col-sm-6 col-xs-6 text-align-right">{{customerDetails.DateModified | date : 'fullDate'}}</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="font-sans-serif size-17 weight-bold inline margin-bottom-15">
              {{ "crm.customer.customer.customer-lifetime-value" | translate }}: {{customerDetails.CurrencySymbol}}{{customerDetails.LifetimeValue | number:2}}
            </div>
            <div class="row">
              <div class="col-md-5 col-sm-6 col-xs-6 text-align-left">{{ "crm.customer.customer.first-name" | translate }}:</div>
              <div class="col-md-7 col-sm-6 col-xs-6 text-align-right">{{customerDetails.FirstName || "-"}}</div>
            </div>
            <div class="row">
              <div class="col-md-5 col-sm-6 col-xs-6 text-align-left">{{ "crm.customer.customer.last-name" | translate }}:</div>
              <div class="col-md-7 col-sm-6 col-xs-6 text-align-right">{{customerDetails.LastName || "-"}}</div>
            </div>
            <div class="row">
              <div class="col-md-5 col-sm-6 col-xs-6 text-align-left">{{ "crm.customer.customer.cc-number" | translate }}:</div>
              <div class="col-md-7 col-sm-6 col-xs-6 text-align-right">{{customerDetails.PaymentInformation.CCNumber || "-"}}</div>
            </div>
            <div class="row">
              <div class="col-md-5 col-sm-6 col-xs-6 text-align-left">{{ "crm.customer.customer.product" | translate }}:</div>
              <div class="col-md-7 col-sm-6 col-xs-6 text-align-right">{{customerDetails.ProductName || "-"}}</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="row">
              <div class="col-md-12 text-right">
                <div class="font-sans-serif size-13 weight-bold inline margin-bottom-5 cursor-pointer margin-top-3">
                  <a href="javascript:;"
                     class="tooltips"
                     data-container="body"
                     data-placement="bottom"
                     data-html="true"
                     data-original-title="Did customer submit a chargeback?">
                    <i class="fa fa-exclamation-circle"></i>
                  </a>
                  <section class="pull-right" style="margin-left: 5px" ng-click="fields.chargeback=!fields.chargeback">
                    <span class="margin-right-5 mobile-sm-font-size">{{ "crm.customer.customer.did-customer-submit-a-chargeback" | translate }}?</span>
                    <div class="checker">
                      <span ng-class="{checked: fields.chargeback}"></span>
                    </div>
                  </section>
                </div>
                </br>
                <div class="font-sans-serif size-13 weight-bold inline margin-bottom-5 cursor-pointer">
                  <a href="javascript:;"
                     class="tooltips cursor-pointer"
                     data-container="body"
                     data-placement="bottom"
                     data-html="true"
                     data-original-title="Is Fraudulent Customer?">
                    <i class="fa fa-exclamation-circle"></i>
                  </a>
                  <section class="pull-right" style="margin-left: 5px" ng-click="fields.fraudulent=!fields.fraudulent">
                    <span class="margin-right-5 mobile-sm-font-size">{{ "crm.customer.customer.fraudulent-customer" | translate }}?</span>
                    <div class="checker">
                      <span ng-class="{checked: fields.fraudulent}"></span>
                    </div>
                  </section>
                </div>
                </br>
                <div class="font-sans-serif size-13 weight-bold inline margin-bottom-5 cursor-pointer">
                  <a href="javascript:;"
                     class="tooltips"
                     data-container="body"
                     data-placement="bottom"
                     data-html="true"
                     data-original-title="Is Test Customer">
                    <i class="fa fa-exclamation-circle"></i>
                  </a>
                  <section class="pull-right" style="margin-left: 5px" ng-click="fields.test=!fields.test">
                    <span class="margin-right-5 mobile-sm-font-size">{{ "crm.customer.customer.test-customer" | translate }}?</span>
                    <div class="checker">
                      <span ng-class="{checked: fields.test}"></span>
                    </div>
                  </section>
                </div>
                </br>
                <div class="font-sans-serif size-15 weight-bold inline margin-bottom-5">
                  <a href="javascript:;" ng-click="customerDetailsShown=!customerDetailsShown;">
                    {{customerDetailsShown ? 'Hide' : 'Show'}} {{ "crm.customer.customer.customer-details" | translate }}
                    <i class="fa" ng-class="{'fa-chevron-right': !customerDetailsShown, 'fa-chevron-down': customerDetailsShown}"></i>
                  </a>
                </div>
                </br>
              </div>
            </div>
          </div>
        </div>
        <section class="margin-top-10 ThemeColor rounded-3 ngFlipX" ng-show="customerDetailsShown"  ng-animate="'animate'">
          <div class="row customer-info-top">
            <!--1st row-->
              <div class="col-md-7">
                <div class="well bg-white" style="min-height: 238px">
                  <div class="row">
                    <div class="col-md-12 text-left">
                      <div class="font-sans-serif size-15 weight-bold margin-bottom-20">
                        {{ "crm.customer.customer.customer-information" | translate }}:
                      </div>
                    </div>
                    <div class="col-md-12 text-left">
                      <div class="table-scrollable customer-info-block" ng-repeat="k in customerDetails | getKeys">
                        <table class="table table-auto-layout" ng-if="customerInfoBlock.indexOf(k)>-1" ng-init="v=customerDetails[k]">
                          <tbody>
                          <tr>
                            <td class="left-side"> <div style="width: 100px">{{splitUppercase(k)}}:</div> </td>
                            <td class="right-side"> {{v || v==0 ? v : "-"}} </td>
                          </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-5">
                <div class="well bg-white" style="min-height: 238px">
                  <div class="row">
                    <div class="col-md-12 text-left">
                      <div class="font-sans-serif size-15 weight-bold margin-bottom-right-20">
                        {{ "crm.customer.customer.contact-information" | translate }}:
                      </div>
                    </div>
                    <div class="col-md-12 text-left">
                      <div class="table-scrollable customer-info-block" ng-repeat="k in customerDetails | getKeys">
                        <table class="table table-auto-layout" ng-if="contactInfoBlock.indexOf(k)>-1" ng-init="v=customerDetails[k]">
                          <tbody>
                          <tr>
                            <td class="left-side"> <div style="width: 75px">{{splitUppercase(k)}}:</div> </td>
                            <td class="right-side"> {{v || v==0 ? v : "-"}} </td>
                          </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
          </div>
          <div class="row customer-info-bottom">
            <!--2nd row-->
            <div class="col-md-4">
              <div class="well bg-white" style="min-height: 275px">
                <div class="row">
                  <div class="col-md-12 text-left">
                    <div class="font-sans-serif size-15 weight-bold margin-bottom-right-20">
                      {{ "crm.customer.customer.shipping-address" | translate }}:
                    </div>
                  </div>
                  <div class="col-md-12 text-left">
                    <div class="table-scrollable customer-info-block" ng-repeat="k in customerDetails.ShippingAddress | getKeys">
                      <table class="table table-auto-layout" ng-init="v=customerDetails.ShippingAddress[k]">
                        <tbody>
                        <tr>
                          <td class="left-side"> <div style="width: 75px">{{splitUppercase(k)}}:</div> </td>
                          <td class="right-side"> {{v || v==0 ? v : "-"}} </td>
                        </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="well bg-white" style="min-height: 275px">
                <div class="row">
                  <div class="col-md-12 text-left">
                    <div class="font-sans-serif size-15 weight-bold margin-bottom-right-20">
                      {{ "crm.customer.customer.billing-address" | translate }}:
                    </div>
                  </div>
                  <div class="col-md-12 text-left">
                    <div class="table-scrollable customer-info-block" ng-repeat="k in customerDetails.BillingAddress | getKeys">
                      <table class="table table-auto-layout" ng-init="v=customerDetails.BillingAddress[k]">
                        <tbody>
                        <tr>
                          <td class="left-side"> <div style="width: 75px">{{splitUppercase(k)}}:</div> </td>
                          <td class="right-side"> {{v || v==0 ? v : "-"}} </td>
                        </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="well bg-white" style="min-height: 275px">
                <div class="row">
                  <div class="col-md-12 text-left">
                    <div class="font-sans-serif size-15 weight-bold margin-bottom-right-20">
                      {{ "crm.customer.customer.payment-information" | translate }}:
                    </div>
                  </div>
                  <div class="table-scrollable customer-info-block" ng-repeat="k in customerDetails.PaymentInformation | getKeys">
                    <table class="table table-auto-layout" ng-init="v=customerDetails.PaymentInformation[k]">
                      <tbody>
                      <tr>
                        <td class="left-side"> <div style="width: 115px">{{splitUppercase(k)}}:</div> </td>
                        <td class="right-side"> {{v || v==0 ? v : "-"}} </td>
                      </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <!-- END Bottom row (Info blocks with bg) -->
      </div>
    </div>
    <!-- END Portlet PORTLET-->
    <!-- BEGIN Portlet PORTLET-->
    <div class="portlet box">
      <div class="portlet-title ThemeColor">
        <div class="caption">
          {{ "crm.customer.customer.transaction-history" | translate }}
        </div>
      </div>
      <div class="portlet-body" style="display: block;">
        <div class="row">

          <div class="col-md-12" ng-if="showAddTransactionSuccess">
            <div class="Metronic-alerts alert alert-success fade in font-size-15">
              <a href="javascript:;" ng-click="closeNotice()"><i class="fa text-FontColor fa-times close"></i></a>
              {{ newTransactionResponse || 'Transaction successfully saved!'}}
            </div>
          </div>

          <!-- BEGIN Transaction History Table-->
          <div class="col-md-12 smTable">
            <div>
              <a href="" class="btn btn-lg ApplyColor margin-bottom-20" ng-click="addTransaction()">
                <i class="fa fa-plus"></i>
                {{ "crm.customer.customer.add-new" | translate }}
              </a>
            </div>
            <section st-table="transactions" st-safe-src="transactionsSafe">
              <div class="table-scrollable">
                <table class="table table-striped table-auto-layout" id="transaction-table">
                  <thead>
                    <tr class="TitleBars top-radius white">
                      <th></th>
                      <th></th>
                      <th st-sort="ProductName" class="cursor-pointer">{{ "crm.customer.customer.product" | translate }}</th>
                      <th st-sort="Total" class="cursor-pointer">{{ "crm.customer.customer.total" | translate }}</th>
                      <th st-sort="Balance" class="cursor-pointer">{{ "crm.customer.customer.balance" | translate }}</th>
                      <th st-sort="TransactionType" class="cursor-pointer">{{ "crm.customer.customer.trans-type" | translate }}</th>
                      <th st-sort="TrackingNo" class="cursor-pointer">{{ "crm.customer.customer.shipping" | translate }}</th>
                      <th st-sort="DateAttempt" class="cursor-pointer">{{ "crm.customer.customer.attempt" | translate }}</th>
                      <th st-sort="transactionid" class="cursor-pointer">{{ "crm.customer.customer.transaction" | translate }}</th>
                      <th st-sort="ProcessingStatus" class="cursor-pointer">{{ "crm.customer.customer.status" | translate }}</th>
                      <th>{{ "crm.customer.customer.cb" | translate }}?</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat-start="row in transactions">
                      <td ng-class="{'opacity-2': row.IsChargeBack || row.transactionid == 0 || row.ProcessingStatus != 'Success' || (row.TransactionType != 'sale' && row.TransactionType != 'capture') }">
                        <a ng-hide="row.expanded" href="javascript:;" ng-click="expandRow(row, true)"><i class="fa fa-plus-circle"></i></a>
                        <a ng-show="row.expanded" href="javascript:;" ng-click="expandRow(row, false)"><i class="fa fa-minus-circle"></i></a>
                      </td>
                      <td>
                        <div class="checker pull-right cursor-pointer"
                             ng-class="{'opacity-2': row.Balance == 0 || (isTranCbDisabled && !row.active) || row.IsChargeBack || row.transactionid == 0 || row.ProcessingStatus != 'Success' || (row.TransactionType != 'sale' && row.TransactionType != 'capture')}"
                             ng-click="toggleActiveTransaction(row)">
                          <span ng-class="{checked: row.active}"></span>
                        </div>
                      </td>
                      <td ng-bind="row.ProductName"></td>
                      <td>{{row.CurrencySymbol}}{{row.Total}}</td>
                      <td>{{row.CurrencySymbol}}{{row.Balance}}</td>
                      <td>{{row.TransactionType}}</td>

                      <td nowrap>
                        <ul style="list-style-type: none; margin: 0; padding: 0;">
                          <li ng-if="row.TrackingNo">{{row.TrackingNo}}</li>
                          <li ng-if="row.ShipmentStatus">
                            <a href="javascript:;">
                              <i title="{{'crm.customer.customer.info-shipping-status' | translate}}" class="fa fa-info-circle"></i>
                            </a>{{row.ShipmentStatus}}
                          </li>
                          <li ng-if="row.IsReturned && row.RmaNo">
                            <span nowrap>RMA#: {{row.RmaNo}}</span>
                          </li>

                          <li ng-if="row.IsReturned && row.ReturnStatus">
                            <a href="javascript:;">
                              <i title="{{'crm.customer.customer.info-return-status' | translate}}" class="fa fa-info-circle"></i>
                            </a>{{row.ReturnStatus}}
                          </li>
                          <li ng-if="!row.IsReturned">
                            <button class="btn btn-primary btn-sm" 
                              ng-click="showRmaError(row.transactionid)" 
                              ng-hide="
                                !row.ShipmentStatus || 
                                (row.TransactionType != 'sale' && row.TransactionType != 'capture') || 
                                !row.TrackingNo ||
                                row.IsReturned
                              ">Create RMA
                            </button>
                          </li>
                        </ul>
                      </td>

                      <td><span ng-show="row.DateAttempt">{{dateFromServer(row.DateAttempt)}}</span></td>
                      <td><span>{{row.transactionid}}</span></br>{{row.processor_id}}</td>
                      <td>
                        <span style="white-space: nowrap;">{{row.OrderType | splitUppercase}}</span>
                        </br>
                        <a href="javascript:;" ng-if="row.ProcessingStatus != 'Success'">
                            <i title="{{'crm.customer.customer.info-gateway-response' | translate}}: {{row.ResponseText}}" class="fa fa-info-circle"></i>
                        </a> {{row.ProcessingStatus}}
                      </td>
                      <td class="center-text">
                        <a ng-class="{'opacity-2': row.IsChargeBack || row.transactionid == 0 || row.ProcessingStatus != 'Success'}"
                           ng-click="(row.IsChargeBack || row.transactionid == 0 || row.ProcessingStatus != 'Success') ? return : cbTransaction(row.transactionid)">
                          <i class="fa fa-arrow-circle-right" style="font-size: 19px;margin-top: 3px;"></i></a>
                      </td>
                    </tr>

                    <tr ng-repeat-end ng-show="row.expanded" ng-repeat="charge in row.Charges track by charge.OrderProductId">
                      <td></td>
                      <td>
                        <div class="checker pull-right cursor-pointer"
                             ng-class="{'opacity-2': row.Balance == 0 || (isTranCbDisabled && !row.active) || row.IsChargeBack || row.transactionid == 0 || row.ProcessingStatus != 'Success'}"
                             ng-click="toggleActiveCharge(row, charge)">
                          <span ng-class="{checked: charge.active}"></span>
                        </div>
                      </td>
                      <td>{{charge.Name}}</td>
                      <td>{{row.CurrencySymbol}}{{charge.TotalAmount}}</td>
                      <td colspan="7"></td
                    </tr>

                  </tbody>
                </table>
              </div>
              <div class="center-text">
                <div  st-items-by-page="10" st-pagination="" st-page-change="goToTableTop('#transaction-table')"></div>
              </div>
            </section>
          </div>

          <!-- END Transaction History Table-->
          <div class="font-sans-serif size-14 inline text-left margin-10 margin-bottom-20">
            {{ "crm.customer.customer.partial-refunds-may-be-allocated-by-selecting-a-transaction-from-the-list-and-entering-an-amount." | translate }}
          </div>

          <div class="col-md-12" ng-if="refundResponse">
              <div class="Metronic-alerts alert fade in font-size-15"
                   ng-class="{ 
                     'alert-success': refundResponse.ResponseCode == '1', 
                     'alert-danger':  refundResponse.ResponseCode == '2' || refundResponse.ResponseCode == '3' 
                   }"
                   ng-show="!closeResponseRefundSuccess">
                <a href="javascript:;" ng-click="closeResponseRefundSuccess=true"><i class="fa text-FontColor fa-times close"></i></a>
                <section>
                  {{refundResponse.ResponseText}}
                </section>
              </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <form name="refundForm">
                <div class="col-md-4">

                  <div class="well well-sm well-light  bg-greyEEE form-group" ng-class="{'has-error': refundForm.refundAmount.$invalid && submittedRefund}">
                    <span class="block">{{ "crm.customer.customer.refund-amount" | translate }}:</span>
                    <input type="text" step="any" class="form-control search-box" min="0" name="refundAmount" ng-model="fields.refundAmountTxtValue" positive-number required>
                    <p class="help-block" ng-show="refundForm.refundAmount.$error.required && submittedRefund">{{ "crm.customer.customer.the-refund-amount-is-required" | translate }}</p>
                    <p class="help-block" ng-show="refundForm.refundAmount.$error.min && submittedRefund">{{ "crm.customer.customer.the-refund-amount-can't-be-less-than-0" | translate }}</p>
                  </div>
                </div>
                <div class="col-md-4">
                  <div
                    crm-radio-list=""
                    options="fieldOptions.refundTypeRLOptions"
                    value="fields.refundTypeRLValue">
                  </div>
                </div>
                <div class="col-md-4">
                  <a href="javascript:;"
                     class="btn btn-lg pull-left ApplyColor margin-bottom-20"
                     ng-disabled="
                       !(transactionsSafe | filter: {active: true}).length || 
                       (!fields.refundAmountTxtValue && fields.refundAmountTxtValue!=0) || 
                       submittingRefund"
                     ng-click="submitRefund(refundForm)">
                    <section ng-hide="submittingRefund">
                      <i class="fa fa-arrow-right"></i>
                      {{ "crm.customer.customer.submit-refund" | translate }}
                    </section>
                    <section ng-show="submittingRefund">...{{ "crm.customer.customer.submitting" | translate }}...</section>
                  </a>
                  <div class="font-sans-serif size-14 inline">
                    {{ "crm.customer.customer.note:-ach-(automated-clearing-house)-transactions-require-a-one-week-waiting-period-prior-to-check-refund-processing." | translate }}
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- END Portlet PORTLET-->

    <!-- BEGIN Portlet PORTLET-->
    <div class="portlet box">
      <div class="portlet-title ThemeColor">
        <div class="caption">
          {{ "crm.customer.customer.recurring-transactions" | translate }}
        </div>
      </div>
      <div class="portlet-body" style="display: block;">
        <div class="row">
          <!-- BEGIN Recurring Transactions Table-->
          <div class="col-md-12 smTable">
            <a href="javascript:;"
               class="btn btn-lg ApplyColor margin-bottom-20"
               ng-click="addRecurringTransaction()">
              <i class="fa fa-plus"></i>
              {{ "crm.customer.customer.add-new" | translate }}
            </a>
            <section st-table="recurringTransactionsCopy" st-safe-src="recurringTransactions" ng-show="recurringTransactions.length">
              <div class="table-scrollable">
                <table class="table table-striped table-auto-layout" id="recurring-table">
                  <thead>
                  <tr class="TitleBars top-radius white">
                    <th st-ratio="15" st-sort="Name" class="cursor-pointer">{{ "crm.customer.customer.name" | translate }}</th>
                    <th st-ratio="10" st-sort="Amount" class="cursor-pointer">{{ "crm.customer.customer.amount" | translate }}</th>
                    <th st-ratio="15" st-sort="NextChargeDueDate" class="cursor-pointer">{{ "crm.customer.customer.next-charge-due-date" | translate }}</th>
                    <th st-ratio="10">{{ "crm.customer.customer.interval" | translate }}</th>
                    <th st-ratio="15" st-sort="RetryChargeDueDate" class="cursor-pointer">{{ "crm.customer.customer.retry-charge-due-date" | translate }}</th>
                    <th st-ratio="10" st-sort="AttemptNo" class="cursor-pointer">{{ "crm.customer.customer.retry-attempt" | translate }} #</th>
                    <th st-ratio="8">{{ "crm.customer.customer.active" | translate }}?</th>
                    <th st-ratio="10" st-sort="DateEntered" class="cursor-pointer">{{ "crm.customer.customer.date-entered" | translate }}</th>
                    <th st-ratio="7">{{ "crm.customer.customer.actions" | translate }}</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr ng-repeat="row1 in recurringTransactionsCopy track by row1.CustomerProductIntervalID">
                    <td st-ratio="15" ng-bind="row1.Name"></td>
                    <td st-ratio="10" ng-bind="row1.Amount | number:2"></td>
                    <td st-ratio="15">
                      <span ng-show="row1.NextChargeDueDate">{{dateFromServer(row1.NextChargeDueDate, true)}}</span>
                    </td>
                    <td st-ratio="10" ng-bind="row1.Interval"></td>
                    <td st-ratio="15">
                      <span ng-show="row1.RetryChargeDueDate">{{dateFromServer(row1.RetryChargeDueDate, true)}}</span>
                    </td>
                    <td st-ratio="10" ng-bind="row1.AttemptNo"></td>
                    <td st-ratio="8">
                      {{row1.IsActive ? 'Yes' : 'No'}}
                      <!--<input type="checkbox" ng-model="row1.IsActive" disabled>-->
                    </td>
                    <td st-ratio="10">
                      <span ng-show="row1.DateEntered">{{dateFromServer(row1.DateEntered, true)}}</span>
                    </td>
                    <td st-ratio="7" class="center-text">
                      <a ng-click="editRecurringTransaction(row1.CustomerProductIntervalID)"><i class="fa fa-pencil"></i></a>
                      <a ng-show="row1.IsActive" ng-click="deleteRecurringTransaction(row1)"><i class="fa  fa-trash-o"></i></a>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
              <div class="center-text">
                <div  st-items-by-page="10" st-pagination="" st-page-change="goToTableTop('#recurring-table')"></div>
              </div>
            </section>
          </div>
          <!-- END Recurring Transactions Table-->
        </div>
      </div>
    </div>
    <!-- END Portlet PORTLET-->

    <div class="row">
      <div class="col-md-3" ng-if="mdfs.length>0">
        <div class="portlet box">
          <div class="portlet-title ThemeColor">
            <div class="caption">
              {{ "crm.customer.customer.merchant-defined-fields" | translate }}
            </div>
          </div>
          <div class="portlet-body" style="display: block;">
            <section st-table="mdfsCopy" st-safe-src="mdfs">
              <div class="table-scrollable">
                <table class="table table-striped table-auto-layout">
                  <thead>
                    <tr class="TitleBars top-radius white">
                      <th st-ratio="48" st-sort="Name" class="cursor-pointer">{{ "crm.customer.customer.name" | translate }}</th>
                      <th st-ratio="50" st-sort="Value" class="cursor-pointer">{{ "crm.customer.customer.value" | translate }}</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="row2 in mdfsCopy">
                      <td st-ratio="50" ng-bind="row2.Name"></td>
                      <td st-ratio="50" ng-bind="row2.Value"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="center-text">
                <div st-items-by-page="10" st-pagination></div>
              </div>
            </section>
          </div>
        </div>
      </div>
      <div ng-class="{'col-md-9': mdfs.length>0, 'col-md-12': !mdfs || mdfs.length==0}">
        <div class="portlet box">
          <div class="portlet-title ThemeColor">
            <div class="caption">
              {{ "crm.customer.customer.log-history" | translate }}
            </div>
          </div>
          <div class="portlet-body" style="display: block;">
            <div class="row">
              <div class="col-md-9">
                <div class="alert alert-warning" role="alert" ng-hide="remarksRaw.length">{{ "crm.customer.customer.no-data" | translate }}</div>
                <section st-table="remarks" st-safe-src="remarksRaw" ng-show="remarksRaw.length">
                  <div class="table-scrollable">
                    <table class="table table-striped table-auto-layout">
                      <thead>
                        <tr class="TitleBars top-radius white">
                          <th st-ratio="29" st-sort="DateEntered" class="cursor-pointer" st-sort-default="reverse">{{ "crm.customer.customer.date-entered" | translate }}</th>
                          <th st-ratio="20" st-sort="User" class="cursor-pointer">{{ "crm.customer.customer.user-name" | translate }}</th>
                          <th st-ratio="50" st-sort="Log" class="cursor-pointer">{{ "crm.customer.customer.action" | translate }}</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr ng-repeat="row3 in remarks">
                          <td st-ratio="30">
                            <span ng-show="row3.DateEntered">
                              {{dateFromServer(row3.DateEntered, true)}}
                            </span>
                          </td>
                          <td st-ratio="20" ng-bind="row3.User"></td>
                          <td st-ratio="50" ng-bind="row3.Log"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="center-text">
                    <div st-items-by-page="10" st-pagination=""></div>
                  </div>
                </section>
              </div>
              <div class="col-md-3">
                <textarea ng-model="fields.message" cols="40" rows="5" maxlength="500" placeholder="Enter remark" class="remarkTxtArea" ng-trim="false"></textarea>
                <div class="row" style="margin-top: 5px">
                  <div class="col-md-6 no-margin">
                    <div class="block">
                      <span>{{500-fields.message.length}} {{ "crm.customer.customer.remaining-characters" | translate }}</span>
                    </div>
                  </div>
                  <div class="col-md-6 no-margin">
                    <a href="javascript:;" class="btn btn-md ApplyColor pull-left full-width" ng-click="addRemark()" ng-disabled="!fields.message.length">
                      <i class="fa fa-plus"></i>
                      ADD
                    </a>
                  </div>
                </div>
                <!-- END Portlet PORTLET-->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


  </div>
</div>
